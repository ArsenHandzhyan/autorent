<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head th:replace="~{fragments/head :: head}">
    <title>История транзакций - AutoRent</title>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>История транзакций</h1>
        <a th:href="@{/account/profile}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left"></i> Назад к профилю
        </a>
    </div>

    <!-- Фильтры -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form th:action="@{/account/transactions}" method="get" class="row g-3">
                <div class="col-md-4">
                    <label for="type" class="form-label">Тип транзакции</label>
                    <select id="type" name="type" class="form-select">
                        <option value="">Все типы</option>
                        <option value="DEPOSIT" th:selected="${param.type == 'DEPOSIT'}">Пополнение</option>
                        <option value="WITHDRAWAL" th:selected="${param.type == 'WITHDRAWAL'}">Списание</option>
                        <option value="TRANSFER" th:selected="${param.type == 'TRANSFER'}">Перевод</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="startDate" class="form-label">Дата начала</label>
                    <input type="date" id="startDate" name="startDate" 
                           th:value="${param.startDate}" class="form-control">
                </div>
                <div class="col-md-4">
                    <label for="endDate" class="form-label">Дата окончания</label>
                    <input type="date" id="endDate" name="endDate" 
                           th:value="${param.endDate}" class="form-control">
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-filter"></i> Применить фильтры
                    </button>
                    <a th:href="@{/account/transactions}" class="btn btn-outline-secondary">
                        <i class="fas fa-times"></i> Сбросить
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Таблица транзакций -->
    <div class="card shadow-sm">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-list text-primary"></i> Список транзакций
            </h5>
        </div>
        <div class="card-body">
            <div th:if="${#lists.isEmpty(transactions)}" class="text-center py-5">
                <i class="fas fa-inbox text-muted" style="font-size: 4rem;"></i>
                <h4 class="text-muted mt-3">Транзакций не найдено</h4>
                <p class="text-muted">Попробуйте изменить параметры фильтрации</p>
            </div>
            
            <div th:if="${not #lists.isEmpty(transactions)}" class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Дата и время</th>
                            <th>Описание</th>
                            <th>Сумма</th>
                            <th>Тип</th>
                            <th>Статус</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="transaction : ${transactions}">
                            <td th:text="${#temporals.format(transaction.createdAt, 'dd.MM.yyyy HH:mm')}">01.01.2023 12:00</td>
                            <td th:text="${transaction.description}">Описание транзакции</td>
                            <td>
                                <span th:class="${transaction.amount.compareTo(java.math.BigDecimal.ZERO) > 0 ? 'text-success fw-bold' : 'text-danger fw-bold'}"
                                      th:text="${transaction.amount > 0 ? '+' + transaction.amount : transaction.amount} + ' ₽'">+1000 ₽</span>
                            </td>
                            <td>
                                <span class="badge" 
                                      th:classappend="${transaction.type == 'DEPOSIT' ? 'bg-success' : 
                                                      (transaction.type == 'WITHDRAWAL' ? 'bg-danger' : 'bg-info')}"
                                      th:text="${transaction.type == 'DEPOSIT' ? 'Пополнение' : 
                                                (transaction.type == 'WITHDRAWAL' ? 'Списание' : 'Перевод')}">
                                    Тип
                                </span>
                            </td>
                            <td>
                                <span class="badge bg-success">Завершена</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Статистика -->
    <div th:if="${not #lists.isEmpty(transactions)}" class="row mt-4">
        <div class="col-md-4">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">Общий доход</h5>
                    <h3 class="mb-0" th:text="${totalIncome + ' ₽'}">0 ₽</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-danger text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">Общие расходы</h5>
                    <h3 class="mb-0" th:text="${totalExpenses + ' ₽'}">0 ₽</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <h5 class="card-title">Количество транзакций</h5>
                    <h3 class="mb-0" th:text="${#lists.size(transactions)}">0</h3>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html> 