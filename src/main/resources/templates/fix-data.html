<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö - AutoRent</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3 class="text-center">–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h5>–ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π</h5>
                            <p>–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–ª–∞—Ç–µ–∂–∏ —Å –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è–º–∏ (–∫—Ä–∞–∫–æ–∑—è–±—Ä—ã). 
                            –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä—É—Å—Å–∫–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤.</p>
                        </div>
                        
                        <div class="mb-4">
                            <h6>–ü—Ä–∏–º–µ—Ä—ã –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:</h6>
                            <ul>
                                <li><code>√ê≈∏√ê¬ª√ê¬∞√ë‚Äö√ê¬µ√ê¬∂ √ê¬∑√ê¬∞ √ê¬¥√ê¬µ√ê¬Ω√ë≈í √ê¬∞√ë‚Ç¨√ê¬µ√ê¬Ω√ê¬¥√ë‚Äπ</code></li>
                                <li><code>√ê¬°√ë‚Ç¨√ê¬µ√ê¬¥√ë¬Å√ë‚Äö√ê¬≤√ê¬∞ √ë¬Å√ê¬ø√ê¬∏√ë¬Å√ê¬∞√ê¬Ω√ë‚Äπ</code></li>
                            </ul>
                            <p><strong>–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:</strong> <code>–ü–ª–∞—Ç–µ–∂ –∑–∞ –¥–µ–Ω—å –∞—Ä–µ–Ω–¥—ã. –°—Ä–µ–¥—Å—Ç–≤–∞ —Å–ø–∏—Å–∞–Ω—ã.</code></p>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button id="fixNotesBtn" class="btn btn-warning btn-lg">
                                <i class="bi bi-tools"></i> –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
                            </button>
                            
                            <button id="checkStatusBtn" class="btn btn-info">
                                <i class="bi bi-info-circle"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                            </button>
                            
                            <a href="/admin/payments" class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–ª–∞—Ç–µ–∂–∞–º
                            </a>
                        </div>
                        
                        <div id="result" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/main.js}"></script>
    
    <script>
        document.getElementById('fixNotesBtn').addEventListener('click', function() {
            const btn = this;
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ...';
            
            fetch('/api/data-fix/fix-payment-notes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('result');
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h5>‚úÖ –£—Å–ø–µ—à–Ω–æ!</h5>
                            <p>${data.message}</p>
                            <small>–í—Ä–µ–º—è: ${new Date(data.timestamp).toLocaleString()}</small>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <h5>‚ùå –û—à–∏–±–∫–∞!</h5>
                            <p>${data.error}</p>
                            <small>–í—Ä–µ–º—è: ${new Date(data.timestamp).toLocaleString()}</small>
                        </div>
                    `;
                }
            })
            .catch(error => {
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏!</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å: ${error.message}</p>
                    </div>
                `;
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        });
        
        document.getElementById('checkStatusBtn').addEventListener('click', function() {
            const btn = this;
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            fetch('/api/data-fix/status')
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <div class="alert alert-info">
                        <h5>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h5>
                        <ul>
                            <li>–í—Å–µ–≥–æ –ø–ª–∞—Ç–µ–∂–µ–π: ${data.totalPayments}</li>
                            <li>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—á–∞–Ω–∏–π: ${data.fixedPayments}</li>
                            <li>–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—á–∞–Ω–∏–π: ${data.corruptedPayments}</li>
                        </ul>
                        <small>–í—Ä–µ–º—è: ${new Date(data.timestamp).toLocaleString()}</small>
                    </div>
                `;
            })
            .catch(error => {
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>‚ùå –û—à–∏–±–∫–∞!</h5>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: ${error.message}</p>
                    </div>
                `;
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        });
    </script>
</body>
</html> 